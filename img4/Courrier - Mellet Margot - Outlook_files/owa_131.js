self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.AttachmentSuggestions.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[127],{1097:function(e){e.exports={b:"Vab",d:"Wab",c:"Xab",a:"Yab"}},1272:function(e,t,n){"use strict";var r=n(2),i=n(6),o=n(1565),c={providers:new i.ObservableMap,loadState:o.a.NotLoaded,removalPending:new i.ObservableMap},a=Object(r.createStore)("fileProviderStoreV2",c);t.a=a},1318:function(e,t,n){"use strict";n.d(t,"b",function(){return o}),n.d(t,"a",function(){return i}),n.d(t,"c",function(){return c});var r=n(2),i=Object(r.action)("FILE_PROVIDER_ADDED",function(e){return{providerViewState:e}}),o=Object(r.action)("FILE_PROVIDER_REMOVED",function(e){return{providerType:e}}),c=Object(r.action)("PROVIDERS_LOADED",function(e){return{providers:e}})},1386:function(e,t,n){"use strict";var r=n(0),i=n(2600),o=n.n(i),c=n(1946),a=n.n(c);function u(e){var t=a()({ProviderType:e});return o()(t)}var s=n(2601),l=n.n(s),d=n(1947),f=n.n(d);function h(e){var t=f()({ProviderType:e});return l()(t)}var p=n(2505),b=n(105);n.d(t,"a",function(){return w}),n.d(t,"b",function(){return A});var v="code",m="token",g=3e3,O=3;function _(e){return{state:e}}function j(e){return e.state}function y(e){return e.code}function w(e,t,n,i,o){var c={providerType:e,getAuthUrlInfo:null,getCSRFToken:j,getOAuthCode:y};return function e(t,n,i,o,c,a,s){return Object(r.__awaiter)(this,void 0,void 0,function(){var l,d;return Object(r.__generator)(this,function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),l=void 0,7!==t&&9!==t&&8!==t?[3,2]:[4,h(t)];case 1:return d=r.sent(),l=d.AttachmentDataProviderCreator.ProviderAppKey,i=d.AttachmentDataProviderCreator.AuthorizationUri,[3,4];case 2:return[4,u(t)];case 3:d=r.sent(),l=d.ProviderAppKey,r.label=4;case 4:return n.getAuthUrlInfo=Object(p.d)(t,i,o,l,c,a),[3,6];case 5:return r.sent(),s>0&&setTimeout(function(){return e(t,n,i,o,c,a,--s)},g),[3,6];case 6:return[2]}})})}(e,c,t,n,i,o,O),c}var I=null;function S(){if(!I){(I={})[3]=w(3,"https://app.box.com/api/oauth2/authorize",Object(p.c)(3),v,_),I[2]=w(2,"https://www.dropbox.com/oauth2/authorize",Object(p.b)(2),v,_);var e=w(6,"https://www.facebook.com/dialog/oauth",Object(p.b)(6),m,function(e){return{state:e,scope:"user_photos,email"}});e.getCSRFToken=j,e.getOAuthCode=function(e){return e.access_token},I[6]=e;var t=w(5,"https://accounts.google.com/o/oauth2/auth",p.a+"/ADPRedirect.aspx",v,function(e){var t={state:e,provider:5..toString(),url:Object(p.b)()};return{state:JSON.stringify(t),scope:"https://www.googleapis.com/auth/drive",access_type:"offline",prompt:"consent",include_granted_scopes:"true"}});t.getCSRFToken=function(e){return JSON.parse(e.state).state},I[5]=t,I[1]=w(1,"https://login.live.com/oauth20_authorize.srf",Object(p.c)(1),v,function(e){return{state:e,scope:"wl.basic onedrive.readwrite wl.offline_access"}}),Object(b.e)("doc-fileProvider-wopiClient")&&(I[7]=w(7,"",Object(p.c)(7),v,_),I[8]=w(8,"",Object(p.c)(8),v,_),I[9]=w(9,"",Object(p.c)(9),v,_))}return I}function A(e){var t=S();return e in t?t[e]:null}},1399:function(e,t,n){"use strict";n.d(t,"b",function(){return o}),n.d(t,"a",function(){return c});var r=n(0),i=n(1272),o=function(){return Object(r.__spread)(Object(i.a)().providers.values())},c=function(e){return Object(i.a)().providers.get(e)||null}},1453:function(e,t,n){"use strict";n.d(t,"b",function(){return r}),n.d(t,"a",function(){return o}),n.d(t,"c",function(){return c});var r,i=n(0);!function(e){e[e.Groups=1e4]="Groups"}(r||(r={}));var o=Object.freeze([1,3,2,6,5,7,8,9]),c=Object.freeze(Object(i.__spread)(o,[0,4,10]))},1483:function(e,t,n){"use strict";var r=n(22),i=n(1880),o=n(1770),c=(n(1272),n(1318)),a=n(1453),u=(n(2457),n(2363),n(1399));var s=n(1738),l=n(1565),d=n(1386);n.d(t,"k",function(){return h}),n.d(t,"m",function(){return p}),n.d(t,"j",function(){return b}),n.d(t,"l",function(){return v}),n.d(t,"b",function(){return i.a}),n.d(t,"h",function(){return o.a}),n.d(t,"d",function(){return c.a}),n.d(t,"e",function(){return c.b}),n.d(t,"n",function(){return c.c}),n.d(t,"a",function(){return a.b}),n.d(t,"g",function(){return u.b}),n.d(t,"i",function(){return s.a}),n.d(t,"c",function(){return l.a}),n.d(t,"f",function(){return d.b});var f=new r.c(function(){return Promise.all([n.e(6),n.e(7),n.e(9),n.e(19),n.e(230)]).then(n.bind(null,13845))}),h=new r.b(f,function(e){return e.loadProviders}),p=new r.b(f,function(e){return e.removeFileProvider}),b=new r.b(f,function(e){return e.addFileProvider}),v=new r.b(f,function(e){return e.removeAndAddFileProvider})},1565:function(e,t,n){"use strict";var r;n.d(t,"a",function(){return r}),function(e){e[e.Loaded=0]="Loaded",e[e.Loading=1]="Loading",e[e.NotLoaded=2]="NotLoaded"}(r||(r={}))},1738:function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(1272);function i(){return Object(r.a)().loadState}},1770:function(e,t,n){"use strict";n.d(t,"a",function(){return u});var r=n(2599),i=n(2362),o=n(2536),c=n(4),a=n(218);function u(e,t){if(void 0===t&&(t=!1),t)return"";switch(e){case 0:return Object(c.a)(o.b);case 1:return Object(c.a)(o.a);case 2:case 9:return Object(c.a)(r.b);case 3:case 7:return Object(c.a)(r.a);case 5:return Object(c.a)(r.e);case 6:return Object(c.a)(r.d);case 4:return Object(c.a)(r.f);case 10:return Object(c.a)(i.b);case 8:return Object(c.a)(r.c);default:return Object(a.a)(e)}}},1880:function(e,t,n){"use strict";var r;!function(e){e[e.None=0]="None",e[e.Images=1]="Images"}(r||(r={})),t.a=r},1946:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){return r.__assign({__type:"GetNewAttachmentDataProviderCreationInfoRequest:#Exchange"},e)}},1947:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){return r.__assign({__type:"GetAttachmentDataProviderCreatorRequest:#Exchange"},e)}},212:function(e,t,n){"use strict";var r=n(0),i=n(219),o=n(200),c=n(231),a=n(325),u=n.n(a),s=n(73),l=n(373),d=n.n(l),f=500;function h(e){return Object(r.__awaiter)(this,void 0,void 0,function(){var t;return Object(r.__generator)(this,function(n){return t={isUserActivity:!1},[2,d()(u()({Resource:e}),t)]})})}function p(e,t){return Object(r.__awaiter)(this,void 0,void 0,function(){return Object(r.__generator)(this,function(n){return t<1?[2,Promise.reject()]:[2,h(e).catch(function(){return Object(s.a)(f).then(function(){return p(e,t-1)})})]})})}var b,v=n(105),m=n(368),g=3,O=500;function _(e){var t=this,n=null,i=null,o=new Promise(function(e,o){return Object(r.__awaiter)(t,void 0,void 0,function(){return Object(r.__generator)(this,function(t){return n=e,i=o,[2]})})}),c={onFulfilled:n,onRejected:i,resource:e};return(null==b&&(b=new m.a(g,j,O)),b).add(c),o}function j(e){return Object(r.__awaiter)(this,void 0,void 0,function(){return Object(r.__generator)(this,function(t){return E(e.resource).then(function(t){e.onFulfilled(t)}).catch(function(t){e.onRejected(t)}),[2]})})}var y=null;function w(){return null==y&&(y=new i.Cache),y}n.d(t,"e",function(){return C}),n.d(t,"b",function(){return k}),n.d(t,"c",function(){return x}),n.d(t,"a",function(){return E}),n.d(t,"d",function(){return P});var I=1,S=12e4,A=3,T=null;function C(e){T=e}function k(e){return Object(r.__awaiter)(this,void 0,void 0,function(){var t;return Object(r.__generator)(this,function(n){switch(n.label){case 0:return null!=(t=P(R(),e))?[3,2]:[4,E(e)];case 1:t=n.sent(),n.label=2;case 2:return[2,null!=t?t.AccessToken:void 0]}})})}function x(e){var t=P(R(),e);if(t)return[t.AccessToken,void 0];if(Object(v.e)("auth-getAccessTokenQueueEnabled")){var n=function(e){return w().get(e)}(e),r=void 0;return n?r=n:(r=_(e),function(e,t){w().put(e,t)}(e,r)),[void 0,r.then(function(t){return function(e){w().del(e)}(e),t.AccessToken})]}return[void 0,E(e).then(function(e){return e.AccessToken})]}function E(e){return Object(r.__awaiter)(this,void 0,void 0,function(){var t,n,i;return Object(r.__generator)(this,function(r){switch(r.label){case 0:return Object(v.e)("auth-getAccessTokenQueueEnabled")?[4,p(e,A)]:[3,2];case 1:return n=r.sent(),[3,4];case 2:return[4,h(e)];case 3:n=r.sent(),r.label=4;case 4:return null!=(t=n)&&0==t.TokenResultCode&&null!=t.AccessTokenExpiry&&(t.ExpiresIn&&t.ExpiresIn>0&&(t.AccessTokenExpiry=Object(c.a)(Date.now(),t.ExpiresIn).toISOString()),(i=new Date(t.AccessTokenExpiry).getTime()-Date.now()-S)>0&&R().put(e,t,i,function(e,t){E(e).catch(function(){})})),[2,t]}})})}function P(e,t){var n=e.get(t),r=void 0;n&&n.AccessTokenExpiry&&(Object(o.a)(new Date(n.AccessTokenExpiry),-I)>new Date(Date.now())&&(r=n));return r}function R(){return null==T&&(T=new i.Cache),T}},219:function(e,t,n){"use strict";function r(){var e=Object.create(null),t=0,n=0,r=0,i=!1;function o(t){r--,delete e[t]}this.put=function(t,n,i,c){if(void 0!==i&&("number"!=typeof i||isNaN(i)||i<=0))throw new Error("Cache timeout must be a positive number");if(void 0!==c&&"function"!=typeof c)throw new Error("Cache timeout callback must be a function");var a=e[t];a?clearTimeout(a.timeout):r++;var u={value:n,expire:i+Date.now()};return isNaN(u.expire)||(u.timeout=setTimeout(function(){o(t),c&&c(t,n)}.bind(this),i)),e[t]=u,n},this.del=function(t){var n=!0,r=e[t];return r?(clearTimeout(r.timeout),!isNaN(r.expire)&&r.expire<Date.now()&&(n=!1)):n=!1,n&&o(t),n},this.clear=function(){for(var o in e)clearTimeout(e[o].timeout);r=0,e=Object.create(null),i&&(t=0,n=0)},this.get=function(o){var c=e[o];if(void 0!==c){if(isNaN(c.expire)||c.expire>=Date.now())return i&&t++,c.value;i&&n++,r--,delete e[o]}else i&&n++;return null},this.size=function(){return r},this.memsize=function(){var t,n=0;for(t in e)n++;return n},this.debug=function(e){i=e},this.hits=function(){return t},this.misses=function(){return n},this.keys=function(){return Object.keys(e)},this.exportJson=function(){var t={};for(var n in e){var r=e[n];t[n]={value:r.value,expire:r.expire||"NaN"}}return JSON.stringify(t)},this.importJson=function(t,n){var r=JSON.parse(t),i=Date.now(),o=n&&n.skipDuplicates;for(var c in r)if(r.hasOwnProperty(c)){if(o)if(e[c])continue;var a=r[c],u=a.expire-i;if(u<=0){this.del(c);continue}u=u>0?u:void 0,this.put(c,a.value,u)}return this.size()}}e.exports=new r,e.exports.Cache=r},2362:function(e){e.exports={a:"lHa",b:"mHa"}},2363:function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(60),i=n(276),o=n(218),c=n(105);function a(e){var t=Object(r.a)();switch(e){case 5:return t.AttachmentPolicy.GoogleDriveAttachmentsEnabled&&t.AttachmentPolicy.ThirdPartyAttachmentsEnabled&&Object(c.e)("doc-fileProvider-gdrive");case 4:case 0:return!0;case 3:return t.AttachmentPolicy.BoxAttachmentsEnabled&&t.AttachmentPolicy.ThirdPartyAttachmentsEnabled&&Object(c.e)("doc-fileProvider-box");case 2:return t.AttachmentPolicy.DropboxAttachmentsEnabled&&t.AttachmentPolicy.ThirdPartyAttachmentsEnabled&&Object(c.e)("doc-fileProvider-dropbox");case 6:return t.AttachmentPolicy.ThirdPartyAttachmentsEnabled&&Object(c.e)("doc-fileProvider-facebook");case 1:return!!Object(i.a)()||Object(c.e)("doc-filePicker-oneDriveConsumerForO365")&&t.AttachmentPolicy.OnedriveAttachmentsEnabled&&t.AttachmentPolicy.ThirdPartyAttachmentsEnabled;case 10:return Object(c.e)("doc-filePicker-mailMessageAttachment");case 7:case 8:case 9:return t.AttachmentPolicy.ThirdPartyAttachmentsEnabled&&Object(c.e)("doc-fileProvider-wopiClient");default:return Object(o.a)(e)}}},2457:function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"b",function(){return o});var r=n(1453),i="file provider is not addable";function o(e){return r.a.indexOf(e)>-1}},2505:function(e,t,n){"use strict";var r=n(804),i=n(3);function o(e,t,n){if(!e||!t||!n)throw new Error("Key and Value parameters should not be null");return e.indexOf("?")>0?e+"&"+t+"="+n:e+"?"+t+"="+n}n.d(t,"a",function(){return c}),n.d(t,"b",function(){return a}),n.d(t,"c",function(){return u}),n.d(t,"d",function(){return s});var c=Object(i.r)()?"https://exchangelabs.live-int.com/owa":"https://outlook.office.com/owa";function a(e){var t=e?encodeURIComponent("?provider="+e):"",n=e&&6===e?"AddFacebookFileProvider.html":"AddFileProvider.html";return Object(r.n)()+"/mail/"+n+t}function u(e){var t=Object(r.n)()+"/mail/AddFileProvider.html",n=encodeURIComponent("provider="+e+"&url="+t);return c+"/ADPRedirect.aspx?"+n}function s(e,t,n,r,i,c){return function(){var e=function(){for(var e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".split(""),t=e.length-1,n=[],r=0;r<16;r++)n.push(e[Math.round(Math.random()*t)]);return"owa_csrf_token_"+n.join("")}(),a=o(t,"client_id",r);if(a=o(a,"redirect_uri",n),a=o(a,"response_type",i),c){var u=c(e);a=Object.keys(u).reduce(function(e,t){return o(e,t,u[t])},a)}return{authUrl:a,redirectUrl:n,csrfToken:e}}}},2536:function(e){e.exports={b:"jHa",a:"kHa"}},2599:function(e){e.exports={b:"dHa",a:"eHa",e:"fHa",d:"gHa",f:"hHa",c:"iHa"}},2600:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(199),i=n(1946);t.default=function(e,t){return void 0===e||e.__type||(e=i.default(e)),r.makeServiceRequest("GetNewAttachmentDataProviderCreationInfo",e,t)}},2601:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(199),i=n(1947);t.default=function(e,t){return void 0===e||e.__type||(e=i.default(e)),r.makeServiceRequest("GetAttachmentDataProviderCreator",e,t)}},2852:function(e,t,n){"use strict";n.r(t);var r=n(2),i=Object(r.action)("getAttachmentSuggestionsAction",function(e){return{referenceItemId:e}}),o=n(759),c=Object(r.action)("storeAttachmentSuggestionsOnItemAction",function(e,t){return{referenceItemId:e,attachmentSuggestions:t}}),a=(Object(r.mutator)(c,function(e){var t=o.H.items.get(e.referenceItemId);t&&(t.AttachmentSuggestions=e.attachmentSuggestions)}),Object(r.action)("storeContextualMRUSuggestionsOnItemAction",function(e,t){return{referenceItemId:e,contextualSuggestions:t}})),u=(Object(r.mutator)(a,function(e){var t=o.H.items.get(e.referenceItemId);t&&(t.ContextualAttachmentSuggestions=e.contextualSuggestions)}),n(1332)),s=Object(r.action)("storeMRUSuggestionsAction",function(e){return{mruAttachments:e}}),l=(Object(r.mutator)(s,function(e){Object(u.a)().attachments=e.mruAttachments}),Object(r.action)("getContextualMRUSuggestionsAction",function(e){return{referenceItemId:e}})),d=Object(r.action)("getMRUSuggestionsAction"),f=Object(r.action)("getReplyWithSuggestionsAction",function(e){return{referenceItemId:e}}),h=n(105);Object(r.orchestrator)(i,function(e){Object(h.e)("mc-replyWithContextualMRU")&&e.referenceItemId?l(e.referenceItemId):(f(e.referenceItemId),d())});var p=n(0),b=n(25);function v(e){return e.Source.LastModifiedBy?e.Source.LastModifiedBy.DisplayName:e.Source.LastShared.SharedBy.DisplayName}var m=n(228),g=n(1093),O=n(502),_="application/json;charset=utf-8",j="/search/api/v1/recommendations",y="recEnableSharedClassicAttachments",w="maxMRUFiles1",I="suggestedattachments";function S(e){return Object(p.__awaiter)(this,void 0,void 0,function(){var t,n,r,i,o,c,a,u,s,l,d;return Object(p.__generator)(this,function(f){switch(f.label){case 0:t=null,n=0,r="",i=null,f.label=1;case 1:return f.trys.push([1,7,8,9]),Object(m.o)("MRUQueryExecuted"),i=new m.a("QueryResponseInformation",{logVerbose:!0}),o=Object(h.e)("mc-replyWithMRUClassic"),e?i.addCustomData({endpoint:3}):i.addCustomData({endpoint:1}),[4,A()];case 2:return c=f.sent(),a=function(e,t,n){var r={};r.headers=new Headers,r.headers.set("Authorization","Bearer "+e),r.headers.set("Content-Type",_),r.method="POST";var i=Object(g.c)();i&&r.headers.append("X-AnchorMailbox",i);r.headers.set("X-Client-LocalTime",(new Date).toISOString());var o=[];n?o.push(I):t&&(o.push(y),Object(h.e)("mc-replyWithMRUCloudyLimited")&&o.push(w));o.length&&r.headers.set("X-Client-Flights",o.join(","));var c={EntityRequests:[n?{Context:{EntityId:n}}:{}],Scenario:{Name:"AttachFile"}};return r.body=JSON.stringify(c),r}(c,o,e),i.addCheckmark("Request"),[4,fetch(j,a)];case 3:return u=f.sent(),i.addCheckmark("Response"),u&&200==u.status?[4,u.text()]:[3,5];case 4:return s=f.sent(),l=JSON.parse(s),t=function(e,t){try{var n=e.EntitySets[0].ResultSets[0].Results;return n.map(function(e){return function(e,t){try{var n=!!e.Source.LastShared&&!e.Source.WebUrl,r=e.Source.Author?e.Source.Author.DisplayName:"";return{Author:r,CreatedBy:r,DateAccessed:e.Source.LastAccessDateTime,DateCreated:null,DateModified:e.Source.LastModifiedDateTime,Endpoint:t?3:n?2:1,FileExtension:e.Source.FileExtension,FileName:e.Source.FileName,FileSize:e.Source.FileSize,FileSourceType:e.ContentSource||e.Provenance,Id:n?e.Source.LastShared.AttachmentId:e.Id,ModifiedBy:v(e),ReferenceId:e.ReferenceId,SourceTitle:e.Source.SiteTitle||e.Source.LastShared.SharingSubject,Text:e.Source.Title,Title:e.Source.Title,Url:e.Source.Url}}catch(e){return b.d.info("[convertMRUAttachmentToReplyWithAttachmentSuggestion] Error accessing MRUAttachment properties: "+e.message),null}}(e,t)})}catch(e){return b.d.info("[fetchMRUSuggestions_getAttachmentsFromResponse] Error: "+e.message),[]}}(l,!!e),n=t.length,[3,6];case 5:r=u?u.status+"-"+u.statusText:"No response",f.label=6;case 6:return[3,9];case 7:return d=f.sent(),r=d.message,[3,9];case 8:return r&&b.d.info("getMRUSuggestions: Error "+r),i.addCustomData({numResults:n}),r?i.endWithError("ServerError",new Error(r)):i.end(),[2,t];case 9:return[2]}})})}function A(){return Object(p.__awaiter)(this,void 0,void 0,function(){var e,t,n;return Object(p.__generator)(this,function(r){switch(r.label){case 0:return e=Object(p.__read)(Object(O.getAccessTokenforResourceAsLazy)(window.location.origin),2),t=e[0],n=e[1],t?[3,2]:[4,n];case 1:t=r.sent(),r.label=2;case 2:return[2,t]}})})}Object(r.orchestrator)(l,function(e){return Object(p.__awaiter)(this,void 0,void 0,function(){var t,n;return Object(p.__generator)(this,function(r){switch(r.label){case 0:return t=e.referenceItemId,o.H.items.get(t)?[4,S(t)]:[3,2];case 1:n=r.sent(),a(t,n),r.label=2;case 2:return[2]}})})}),Object(r.orchestrator)(d,function(){return Object(p.__awaiter)(this,void 0,void 0,function(){var e;return Object(p.__generator)(this,function(t){switch(t.label){case 0:return[4,S(null)];case 1:return(e=t.sent())&&s(e),[2]}})})});var T=n(1046),C=n(1041),k=n(503),x=n.n(k),E=n(855),P=n.n(E),R="EntityExtraction/SubstrateSearchSuggestions",D="EntityExtraction/ReplyWithQueryCoverage",U=x()({PropertyName:R,DistinguishedPropertySetId:"Common",PropertyType:"String"}),L=x()({PropertyName:D,DistinguishedPropertySetId:"Common",PropertyType:"String"});function M(e){return Object(p.__awaiter)(this,void 0,void 0,function(){var t,n,r,i,o;return Object(p.__generator)(this,function(c){switch(c.label){case 0:return null!=(t=N(e)).SubstrateSearchSuggestions||null!=t.ReplyWithQueryCoverage?[3,2]:(n=P()({BaseShape:"IdOnly",AdditionalProperties:[U,L]}),[4,Object(T.a)([e.ItemId.Id],n,null,null,e.MailboxInfo&&e.MailboxInfo.requestOptions)]);case 1:r=c.sent(),Object(C.a)(r[0])&&((i=r[0])&&i.Items&&i.Items[0]?(o=i.Items[0],t=N(o)):b.d.info("getReplyWithProperties: Unable to parse GetItem response properly.")),c.label=2;case 2:return[2,t]}})})}function N(e){var t={SubstrateSearchSuggestions:null,ReplyWithQueryCoverage:null},n=e.ExtendedProperty;if(n)for(var r=n.length,i=0;i<r;i++){var o=n[i];o.ExtendedFieldURI.PropertyName===R?t.SubstrateSearchSuggestions=o:o.ExtendedFieldURI.PropertyName===D&&(t.ReplyWithQueryCoverage=o)}return t}var F=n(174),z="/ows/search/api/v1/";function W(e){return Object(p.__awaiter)(this,void 0,void 0,function(){var t,n,r,i,o=this;return Object(p.__generator)(this,function(c){switch(c.label){case 0:return c.trys.push([0,3,,4]),t=function(e){var t={},n=function(e){var t=[];if(null!=e.ReplyWithQueryCoverage)for(var n=JSON.parse(e.ReplyWithQueryCoverage.Value)[0],r=n.coverageCheckResults,i=Object.keys(r),o=0;o<i.length;o++){var c=i[o];r[c]||t.push(c)}return t}(e);return JSON.parse(e.SubstrateSearchSuggestions.Value)[0].requests.forEach(function(e){var r=e.InputText;if(!n.includes(r)){var i=function(e,t){for(var n,r,i=z+e,o=0;o<t.length;o++)n=t[o].Key,r=t[o].Value,i+=0==o?"?":"&",i+=n+"="+r;return i}(e.Endpoint,e.UrlParameters);t[r]=i}}),t}(e),n={},(r=Object.keys(t)).length>0?(Object(m.o)("ReplyWithQueryExecuted"),[4,Promise.all(r.map(function(e){return Object(p.__awaiter)(o,void 0,void 0,function(){var r,i;return Object(p.__generator)(this,function(o){switch(o.label){case 0:return r=n,i=e,[4,B(t[e])];case 1:return[2,r[i]=o.sent()]}})})}))]):[3,2];case 1:return c.sent(),[2,G(n)];case 2:return[3,4];case 3:return i=c.sent(),b.d.info("Failed to parse property, error: "+i.message),[3,4];case 4:return[2,null]}})})}function B(e){return Object(p.__awaiter)(this,void 0,void 0,function(){var t,n,r,i,o;return Object(p.__generator)(this,function(c){switch(c.label){case 0:t=null,n=0,r="",i=null,c.label=1;case 1:return c.trys.push([1,3,4,5]),(i=new m.a("QueryResponseInformation")).addCustomData({endpoint:0}),[4,Object(F.b)(e)];case 2:return t=c.sent(),i.addCheckmark("Response"),t&&0!=t.length||(r="No response payload"),[3,5];case 3:return o=c.sent(),r=o.message,[3,5];case 4:return n=function(e){try{return e.Groups[0].Suggestions.length}catch(e){return 0}}(t),i.addCustomData({numResults:n}),r?i.endWithError("ServerError",new Error(r)):i.end(),[2,t];case 5:return[2]}})})}function G(e){try{var t={};return Object.keys(e).forEach(function(n){t[n]=e[n].Groups[0].Suggestions;for(var r=0;r<t[n].length;r++)t[n][r].Endpoint=0}),t}catch(e){return b.d.info("getSentenceToAttachmentSuggestionsMap: Failed to execute, error: "+e.message),null}}function H(e){return Object(p.__awaiter)(this,void 0,void 0,function(){var t,n;return Object(p.__generator)(this,function(r){switch(r.label){case 0:return t=null,[4,M(e)];case 1:return(n=r.sent())?[4,W(n)]:[3,3];case 2:t=r.sent(),r.label=3;case 3:return[2,t]}})})}Object(r.orchestrator)(f,function(e){return Object(p.__awaiter)(this,void 0,void 0,function(){var t,n,r;return Object(p.__generator)(this,function(i){switch(i.label){case 0:return t=e.referenceItemId,!(n=o.H.items.get(t))||n.AttachmentSuggestions?[3,2]:[4,H(n)];case 1:r=i.sent(),c(t,r),i.label=2;case 2:return[2]}})})});var V=n(911),q=n(1483);function Q(e,t){return Object(p.__awaiter)(this,void 0,void 0,function(){var n;return Object(p.__generator)(this,function(r){switch(r.label){case 0:return n=null,Object(q.i)()!==q.c.NotLoaded?[3,2]:[4,q.k.import()];case 1:return r.sent()(function(r){n=X(Object(q.g)(),e),t(n)}),[3,3];case 2:n=X(Object(q.g)(),e),t(n),r.label=3;case 3:return[2]}})})}function X(e,t){var n=function(e){for(var t=0;t<e.length;t++)if(0==e[t].type)return e[t].model.Id;return b.d.warn("createCloudFileFromAttachmentData: Could not get OneDrive Pro provider ID. Attachment will not upload."),""}(e);return{fileType:3===t.Endpoint?V.a.ContextualSuggestion:V.a.CloudSuggestion,name:t.FileName,size:null,providerId:n,providerType:0,location:t.Url,providerEndpointUrl:null,isFolder:!1,fileId:t.Id,fileParentId:null,thumbnailUrl:null,previewUrl:null,type:null}}n.d(t,"getAttachmentSuggestionsAction",function(){return i}),n.d(t,"createCloudFileFromAttachmentData",function(){return Q})},325:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){return r.__assign({__type:"TokenRequest:#Exchange"},e)}},368:function(e,t,n){"use strict";var r=function(){function e(e,t,n){this.maxParallelTasks=e,this.taskCallback=t,this.taskDelay=n,this.taskList=[],this.numberOfTasksRunning=0}return e.prototype.add=function(e){this.taskList.unshift(e),this.scheduleTask()},e.prototype.clear=function(){this.taskList.splice(0,this.taskList.length)},e.prototype.canRunMoreTasks=function(){return this.numberOfTasksRunning<this.maxParallelTasks&&this.taskList.length>0},e.prototype.scheduleTask=function(){var e=this;this.canRunMoreTasks()&&setTimeout(function(){e.tryRunTask()},this.taskDelay)},e.prototype.tryRunTask=function(){this.canRunMoreTasks()&&this.runTask()},e.prototype.onTaskComplete=function(){this.numberOfTasksRunning--,this.scheduleTask()},e.prototype.runTask=function(){var e=this,t=this.taskList.pop();this.numberOfTasksRunning++,this.taskCallback(t).then(function(){e.onTaskComplete()}).catch(function(){e.onTaskComplete()}),this.scheduleTask()},e}();n.d(t,"a",function(){return r})},373:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(199),i=n(325);t.default=function(e,t){return void 0===e||e.__type||(e=i.default(e)),r.makeServiceRequest("GetAccessTokenforResource",e,t)}},502:function(e,t,n){"use strict";n.r(t);var r=n(219),i=n(212);function o(e){Object(i.e)(new r.Cache),Object(i.b)(e.location.origin)}var c=n(0),a=n(59),u=n(264),s=n.n(u),l=n(231),d={};function f(e){return Object(c.__awaiter)(this,void 0,void 0,function(){var t,n,r;return Object(c.__generator)(this,function(i){switch(i.label){case 0:t=e.client_id+e.scope,n=encodeURIComponent(t),r={},i.label=1;case 1:return i.trys.push([1,3,4,5]),[4,h(e,window)];case 2:return r=i.sent(),[3,5];case 3:return i.sent(),r.TokenResultCode=2,[3,5];case 4:return function(e,t){var n=t.document.getElementById(e);null!=n&&(n.removeEventListener("load",d[e]),t.document.body.removeChild(n),delete d[e])}(n,window),[7];case 5:return[2,r]}})})}function h(e,t){return Object(c.__awaiter)(this,void 0,void 0,function(){var n,r,i;return Object(c.__generator)(this,function(o){return n=encodeURIComponent(e.client_id+e.scope),r=function(e){var t={response_type:"token",prompt:"none",redirect_uri:e.redirect_uri,scope:e.scope,client_id:e.client_id};return e.authorization_uri+"?"+a.stringify(t)}(e),t.document.getElementById(n)?[2,{TokenResultCode:2}]:((i=t.document.createElement("iframe")).src=r.toString(),i.style.display="none",i.id=n,t.document.body.appendChild(i),[2,new Promise(function(e,r){d[n]=function(n){var o={};try{i.contentWindow&&i.contentWindow.location.origin==t.location.origin&&(o=function(e){var t=a.parse(e),n={};t.access_token?(n.AccessToken=t.access_token,n.AccessTokenExpiry=Object(l.a)(Date.now(),parseInt(t.expires_in)).toISOString(),n.TokenResultCode=0):"login_required"==t.error||"interaction_required"==t.error||"consent_required"==t.error?n.TokenResultCode=3:n.TokenResultCode=2;return n}(i.contentWindow.location.hash.substring(1)))}catch(e){o.TokenResultCode=2,r(o)}e(o)},i.addEventListener("load",d[n],!1)})])})})}var p=null;function b(e){return Object(c.__awaiter)(this,void 0,void 0,function(){var t,n,r,i;return Object(c.__generator)(this,function(o){switch(o.label){case 0:return t={scope:e,client_id:"",authorization_uri:"",redirect_uri:""},n=void 0,[4,s()()];case 1:return 0!=(r=o.sent()).ResultCode||null==r.ImplicitGrantAuthorizationUrl||""==r.ImplicitGrantAuthorizationUrl?[2,n]:(i=a.parse(r.ImplicitGrantAuthorizationUrl.split("?")[1]||"")).client_id&&i.redirect_uri?(t.client_id=i.client_id,t.authorization_uri=r.ImplicitGrantAuthorizationUrl.split("?")[0],t.redirect_uri=i.redirect_uri,[4,v(t)]):[3,3];case 2:n=o.sent(),o.label=3;case 3:return[2,n]}})})}function v(e){return Object(c.__awaiter)(this,void 0,void 0,function(){var t,n;return Object(c.__generator)(this,function(r){switch(r.label){case 0:return t=e.client_id+e.scope,null!=(n=Object(i.d)(m(),t))?[3,2]:[4,f(e)];case 1:n=r.sent(),function(e,t){if(t&&0==t.TokenResultCode&&t.AccessTokenExpiry){var n=new Date(t.AccessTokenExpiry).getTime()-Date.now();n>0&&m().put(e,t,n)}}(t,n),r.label=2;case 2:return[2,0==n.TokenResultCode?n.AccessToken:void 0]}})})}function m(){return null==p&&(p=new r.Cache),p}var g=n(204),O=n(377);var _=!1;function j(e){_||(!function(e){var t=Object(O.a)("/owa",e);Object(g.initializeServiceRequest)({baseUrl:t})}(e),_=!0)}function y(e,t,n,r){n?e.acquireTokenPopup(t,null,n,r):e.acquireToken(t,r)}var w=n(22),I=new w.c(function(){return Promise.all([n.e(520),n.e(108)]).then(n.bind(null,14083))}),S=new w.a(I,function(e){return e.createAdalAuthenticationContext});var A=function(e,t,n,r){return function(i,o){i||!o?r(i,null):(e.getCachedUser(),y(e,t,n,r))}},T="adalIdTokenFrame";function C(e,t,n,r){e.config.displayCall=function(i){!function(e){if(-1==e.indexOf("?"))throw new Error("Invalid Url in Adal Auth Context Display Call")}(i),window.detectUserCachedCallback=A(e,t,n,r),function(e,t){e._addAdalFrame(T).src="about:blank",e._loadFrame(t+"&prompt=none",T)}(e,i)},e.login()}function k(e,t,n,r,i){return Object(c.__awaiter)(this,void 0,void 0,function(){var o;return Object(c.__generator)(this,function(c){switch(c.label){case 0:return"https://login.microsoftonline.com/",[4,S.importAndExecute("https://login.microsoftonline.com/",e,t)];case 1:return o=c.sent(),o.getCachedUser()?y(o,n,r,i):C(o,n,r,i),[2]}})})}n.d(t,"registerTokenProvider",function(){return o}),n.d(t,"getAccessTokenforResource",function(){return i.b}),n.d(t,"getAccessTokenforResourceAsLazy",function(){return i.c}),n.d(t,"getDelegationToken",function(){return v}),n.d(t,"getDelegationTokenForOwa",function(){return b}),n.d(t,"bootstrap",function(){return j}),n.d(t,"getAccessTokenOnBehalfOfResource",function(){return k})},788:function(e,t,n){"use strict";function r(e){if(!e)return null;var t=e.lastIndexOf(".");return t>0?e.substr(t).toLowerCase():null}function i(e){var t=r(e);return t?t.replace(".",""):null}var o=n(1097),c=n(4);function a(e){var t;return e>=1073741824?(e/=1073741824,t=Object(c.a)(o.b)):e>=1048576?(e/=1048576,t=Object(c.a)(o.d)):e>=1024?(e/=1024,t=Object(c.a)(o.c)):t=Object(c.a)(o.a),Object(c.b)(t,Math.round(e))}function u(e){return e&&(t=e,(n=l.exec(t))&&n.length>1&&s[n[1].toLowerCase()]);var t,n}var s={"image/bmp":".bmp","image/x-ms-bmp":".bmp","image/gif":".gif","image/jpeg":".jpeg","image/png":".png","image/vnd.adobe.photoshop":".psd","image/tiff":".tiff"},l=/^\s*([^;\s]*)(?:;|\s|$)/;var d=n(35),f=[".bmp",".gif",".jpe",".jpeg",".jpg",".jfif",".dib",".png",".psd"],h=[".tiff",".tif"];function p(e,t,n){void 0===n&&(n=!0);var i=r(e)||u(t);return!!i&&(f.indexOf(i.toLowerCase())>=0||n&&h.indexOf(i.toLowerCase())>=0&&(Object(d.d)()||Object(d.c)()||Object(d.g)()||Object(d.f)()&&!Object(d.i)()))}var b,v=n(105),m=[".pdf",".doc",".docx",".odt",".rtf",".ppt",".pptx",".pptm",".potx",".potm",".pot",".ppxx",".pps",".odp"];function g(e){if(!Object(v.e)("doc-attachment-documentThumbnail"))return!1;var t=r(e);return!!t&&m.indexOf(t.toLowerCase())>=0}function O(e){switch(e){case".doc":case".docm":case".docx":case".dot":case".dotm":case".dotx":case".odt":case".rtf":return b.Word;case".csv":case".ods":case".xls":case".xlsb":case".xlsm":case".xlsx":return b.Excel;case".odp":case".pot":case".potm":case".potx":case".pps":case".ppsm":case".ppsx":case".ppt":case".pptm":case".pptx":return b.PowerPoint;default:return null}}!function(e){e[e.Word=0]="Word",e[e.Excel=1]="Excel",e[e.PowerPoint=2]="PowerPoint"}(b||(b={})),n.d(t,"b",function(){return r}),n.d(t,"c",function(){return i}),n.d(t,"g",function(){return a}),n.d(t,"e",function(){return p}),n.d(t,"f",function(){return g}),n.d(t,"d",function(){return O}),n.d(t,"a",function(){return b})},792:function(e,t,n){"use strict";var r;n.d(t,"a",function(){return r}),function(e){e[e.Base64InlineImage=0]="Base64InlineImage",e[e.Cloud=1]="Cloud",e[e.Local=2]="Local",e[e.MailItem=3]="MailItem",e[e.Uri=4]="Uri",e[e.AttachmentItem=5]="AttachmentItem",e[e.CloudSuggestion=6]="CloudSuggestion",e[e.AttachmentItemSuggestion=7]="AttachmentItemSuggestion",e[e.Inline=8]="Inline",e[e.Smime=9]="Smime",e[e.FilesHub=10]="FilesHub",e[e.GroupFilesHub=11]="GroupFilesHub",e[e.MailSearchFileSuggestion=12]="MailSearchFileSuggestion",e[e.Unknown=13]="Unknown",e[e.ContextualSuggestion=14]="ContextualSuggestion"}(r||(r={}))},911:function(e,t,n){"use strict";var r=n(792),i={BOX:"Box",DROPBOX:"Dropbox",FACEBOOK:"Facebook",GDRIVE:"GDrive",MAILBOX:"Mailbox",ONE_DRIVE_CONSUMER:"OneDriveConsumer",ONE_DRIVE_PRO:"OneDrivePro",RECENT_ATTACHMENTS:"RecentAttachments",WOPI:"Wopi",WOPI_BOX:"WopiBox",WOPI_EGNYTE:"WopiEgnyte"};function o(e){switch(e?e.toLowerCase():null){case i.ONE_DRIVE_PRO.toLowerCase():return 0;case i.GDRIVE.toLowerCase():return 5;case i.ONE_DRIVE_CONSUMER.toLowerCase():return 1;case i.DROPBOX.toLowerCase():return 2;case i.BOX.toLowerCase():return 3;case i.WOPI_BOX.toLowerCase():return 7;case i.WOPI_EGNYTE.toLowerCase():return 8;case i.MAILBOX.toLowerCase():return 4;case i.FACEBOOK.toLowerCase():return 6;default:return null}}function c(e){return null==e?null:{attachmentItemId:e.Id,name:e.Name,size:e.Size,fileType:r.a.AttachmentItem,type:"ItemIdAttachment:#Exchange"}}function a(e){return null==e?null:{fileType:r.a.Cloud,name:e.Name,size:e.Size,providerId:e.AttachmentProviderId,providerType:e.ProviderType,location:e.Location,providerEndpointUrl:e.ProviderEndpointUrl,isFolder:1===e.Type,fileId:e.Id,fileParentId:e.ParentId,thumbnailUrl:e.Thumbnail?e.Thumbnail.Url:"",previewUrl:e.Preview?e.Preview.Url:"",type:e.MimeType}}function u(e){if(!e)return null;for(var t=[],n=0;n<e.length;n++){var i=e[n],o={fileType:r.a.Local,name:i.name,size:i.size,type:i.type,fileObject:i};t.push(o)}return t}function s(e,t,n){var i=[],o={fileType:r.a.MailItem,name:e,size:n||0,mimeContent:t};return i.push(o),i}var l=n(25);function d(e,t,n){if(e.length!=t.length)return l.d.error("The sizes of subjects and latestItemIds are different"),null;for(var i=[],o=0;o<e.length;o++){var c={fileType:r.a.MailItem,name:e[o],size:n&&n[o]||0,itemId:t[o]};i.push(c)}return i}var f=n(788);function h(e){return e.map(function(e){return{fileType:r.a.Uri,name:e.name,type:Object(f.b)(e.url),size:0,uri:e.url}})}n.d(t,"b",function(){return o}),n.d(t,"e",function(){return u}),n.d(t,"g",function(){return d}),n.d(t,"c",function(){return c}),n.d(t,"d",function(){return a}),n.d(t,"h",function(){return h}),n.d(t,"f",function(){return s}),n.d(t,"a",function(){return r.a})}},0,[6,7,9,19,230,0,1,532,182,520,108,23,119]]);
//# sourceMappingURL=owa.AttachmentSuggestions.js.map
self.scriptsLoaded['owa.AttachmentSuggestions.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.AttachmentSuggestions.js'] = (new Date()).getTime();