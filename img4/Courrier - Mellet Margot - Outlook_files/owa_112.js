self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.SharePointLink.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[418],{1097:function(e){e.exports={b:"Vab",d:"Wab",c:"Xab",a:"Yab"}},1633:function(e,t,n){"use strict";var r=n(2),c=Object(r.createStore)("bposStore",{bposNavBarData:null})();t.a=c},1959:function(e,t,n){"use strict";var r=n(1633),c=n(2),o=Object(c.action)("SET_BPOS_NAV_BAR_DATA ",function(e){return{bposNavBarData:e}});Object(c.mutator)(o,function(e){r.a.bposNavBarData=e.bposNavBarData});var a=n(2254),i=n.n(a);var u=n(2150),s=n(110),f=Object(c.action)("LOAD_BposNavBarData"),d=f;function l(){return r.a.bposNavBarData}Object(c.orchestrator)(f,function(e){Object(s.p)()||i()().then(function(e){o(e),Object(u.a)()})}),n.d(t,"b",function(){return d}),n.d(t,"a",function(){return l}),n.d(t,"c",function(){return o})},2150:function(e,t,n){"use strict";var r=n(2);t.a=Object(r.action)("ON_BPOS_NAV_BAR_DATA_LOADED")},2254:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(199);t.default=function(e){return r.makeServiceRequest("GetBposShellInfoNavBarData",{},e)}},2294:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){return r.__assign({__type:"FetchDataProviderResourceRequest:#Exchange"},e)}},3005:function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(0),c=n(3006),o=n.n(c),a=n(2294),i=n.n(a),u=n(25);function s(e,t,n){return Object(r.__awaiter)(this,void 0,void 0,function(){var c,a,s,f,d,l,b,p,O,v;return Object(r.__generator)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),c=btoa(t),a="u!"+c.replace(/^\=+|\=+$/g,"").replace("/","_").replace("+","-"),s=new RegExp(/.+?\:\/\/.+?(\/)/g).exec(t)[0],f=s+"_api/v2.0/shares/"+a+"/root?select=openWith/wac,officeBundle,@content.downloadUrl,name,size,currentUserRole&action="+(n?"Open":"View"),d=i()({ProviderType:e,Url:f}),l=(new Date).getTime(),[4,o()(d)];case 1:if(200===(b=r.sent()).Status&&b.Body)return p=(new Date).getTime(),(O=JSON.parse(b.Body)).fetchStartTime=l,O.responseStartTime=p,O.openWith.wac.fileGetUrl=O["@content.downloadUrl"],!n&&O.currentUserRole&&(O.currentUserRole.readOnly=!0),[2,O];throw new Error("Result status is: "+b.Status+" or empty response body.");case 2:return v=r.sent(),u.d.warn("Something went wrong while calling fetchDataProviderResourceOperation: "+v),[3,3];case 3:return[2,null]}})})}},3006:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(199),c=n(2294);t.default=function(e,t){return void 0===e||e.__type||(e=c.default(e)),r.makeServiceRequest("FetchDataProviderResource",e,t)}},3096:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(3210),c=n.n(r);function o(e,t,n,r,o){return void 0===n&&(n=!1),void 0===r&&(r=!1),c()({request:{Url:e,IsEdit:r,ProviderType:t,ShouldGrantAccess:n}},o)}},3210:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(199),c=n(3211);t.default=function(e,t){return void 0===e.request||e.request.__type||(e.request=c.default(e.request)),r.makeServiceRequest("GetWacInfo",e,t)}},3211:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){return r.__assign({__type:"GetWacInfoRequest:#Exchange"},e)}},3245:function(e,t,n){"use strict";n.d(t,"h",function(){return r}),n.d(t,"i",function(){return c}),n.d(t,"e",function(){return o}),n.d(t,"f",function(){return a}),n.d(t,"b",function(){return i}),n.d(t,"d",function(){return u}),n.d(t,"a",function(){return s}),n.d(t,"c",function(){return f}),n.d(t,"g",function(){return d});var r=108e6,c=2,o="SP_LINK_CLICK_EVENT_LISTENER",a="SP_LINK_MOUSEUP_EVENT_LISTENER",i="originalsrc",u="shash",s="data-auth",f="&reserved=0",d="Verified"},3699:function(e,t,n){"use strict";n.d(t,"h",function(){return c}),n.d(t,"g",function(){return o}),n.d(t,"e",function(){return a}),n.d(t,"a",function(){return i}),n.d(t,"d",function(){return u}),n.d(t,"b",function(){return s}),n.d(t,"f",function(){return f}),n.d(t,"c",function(){return d});var r=n(2),c=Object(r.action)("tryQueueGetWacInfo",function(e){return{url:e}}),o=Object(r.action)("queueGetWacInfo",function(e){return{url:e}}),a=Object(r.action)("processGetWacInfoQueue"),i=Object(r.action)("getWacInfoQueueShift"),u=Object(r.action)("onStartGetWacInfoOperation",function(e){return{url:e}}),s=Object(r.action)("onFinishGetWacInfoOperation",function(e){return{url:e}}),f=Object(r.action)("pushSupressedUrl",function(e){return{url:e}}),d=Object(r.action)("onGetWacInfoSuccess",function(e,t){return{url:e,wacUrlInfo:t}})},3700:function(e,t,n){"use strict";var r=n(6),c=n(2),o={activeGetWacInfoOperations:[],getWacInfoQueue:[],suppressedUrls:[],docLinkPreviewInfoMap:new r.ObservableMap},a=Object(c.createStore)("sharePointDocLinkPreview",o);t.a=a()},4730:function(e,t,n){"use strict";n.r(t);var r=n(3699),c=n(3700),o=n(2);Object(o.mutator)(r.d,function(e){var t=e.url;c.a.activeGetWacInfoOperations.push(t)}),Object(o.mutator)(r.b,function(e){var t=e.url;c.a.activeGetWacInfoOperations.splice(c.a.activeGetWacInfoOperations.indexOf(t),1)}),Object(o.mutator)(r.c,function(e){var t=e.url,n=e.wacUrlInfo,r={time:Date.now(),wacUrlInfo:n};c.a.docLinkPreviewInfoMap.set(t,r)}),Object(o.mutator)(r.g,function(e){var t=e.url;c.a.getWacInfoQueue.push(t)}),Object(o.mutator)(r.a,function(){c.a.getWacInfoQueue.shift()}),Object(o.mutator)(r.f,function(e){var t=e.url;c.a.suppressedUrls.push(t)});var a=n(1982),i=n(3245),u=n(7301),s=n(7302);Object(o.orchestrator)(a.a,function(e){var t=e.element;t.addEventListener("click",s.a),t[i.e]=s.a,t.addEventListener("mouseup",u.a),t[i.f]=u.a});var f=n(0),d=n(3096),l=n(3005),b=n(105),p=n(788),O=n(4954);function v(e,t){return Object(f.__awaiter)(this,void 0,void 0,function(){var n,c,o,a;return Object(f.__generator)(this,function(i){switch(i.label){case 0:return i.trys.push([0,,9,10]),Object(r.d)(e),n=null,Object(b.e)("doc-SxS-jsApi-ODB-Links")?[4,Object(l.a)(0,e,!0)]:[3,6];case 1:return(c=i.sent())?[3,2]:(Object(r.f)(e),[2,null]);case 2:return o=Object(p.b)(c.name),(a=Object(p.d)(o))!==p.a.Word&&a!==p.a.Excel&&a!==p.a.PowerPoint?[3,3]:(n={wacUrl:c.openWith.wac.applicationUrl,jsApiInfo:{bootScriptUrl:c.openWith.wac.bootstrapperUrl,wopiSrcUrl:c.openWith.wac.wopiSrc,accessToken:c.openWith.wac.accessToken,fileSize:c.size,fileGetUrl:c.openWith.wac.fileGetUrl,bundleInfo:c.officeBundle,fetchStartTime:c.fetchStartTime,responseStartTime:c.responseStartTime,openUrl:e,fileName:c.name},readOnly:c.currentUserRole.readOnly},[3,5]);case 3:return[4,j(e)];case 4:n=i.sent(),i.label=5;case 5:return[3,8];case 6:return[4,j(e)];case 7:n=i.sent(),i.label=8;case 8:return n&&Object(r.c)(e,n),t?[2,Object(O.a)(e)]:[2,null];case 9:return Object(r.b)(e),[7];case 10:return[2]}})})}function j(e){return Object(f.__awaiter)(this,void 0,void 0,function(){var t;return Object(f.__generator)(this,function(n){switch(n.label){case 0:return[4,Object(d.a)(e,0)];case 1:if(9===(t=n.sent()).Status||6===t.Status||5===t.Status)Object(r.f)(e);else if(0===t.Status)return[2,{wacUrl:t.WacUrl,bootScriptUrl:t.BootScriptUrl,wopiSrcUrl:t.WopiSrcUrl,accessToken:t.AccessToken,token:t.Token}];return[2,null]}})})}Object(o.orchestrator)(r.e,function(){return Object(f.__awaiter)(void 0,void 0,void 0,function(){var e;return Object(f.__generator)(this,function(t){switch(t.label){case 0:if(!c.a.getWacInfoQueue.length)return[2];if(c.a.activeGetWacInfoOperations.length>=i.i)return[2];e=c.a.getWacInfoQueue[0],Object(r.d)(e),Object(r.a)(),t.label=1;case 1:return t.trys.push([1,,3,4]),[4,v(e,!1)];case 2:return t.sent(),[3,4];case 3:return Object(r.b)(e),Object(r.e)(),[7];case 4:return[2]}})})});var h=n(228),m=n(4747),w=n(5611);Object(o.orchestrator)(a.d,function(e){var t=e.element,n=e.itemId;if("a"===t.tagName.toLowerCase()){var r=t;if(Object(w.a)(r)){var c=t.getAttribute(i.b);Object(m.a)(c)&&(Object(m.b)(c)?Object(b.e)("doc-sharepoint-serviceGeneratedLinkTelemetry")&&Object(a.a)(t):Object(b.e)("doc-SxS-jsApi-ODB-Links")&&t.getAttribute(i.a)===i.g?Object(a.b)(t,c,n):Object(b.e)("doc-sharepoint-serviceGeneratedLinkTelemetry")&&Object(a.a)(t),g())}else{c=r.href;Object(m.a)(c)&&(Object(m.b)(c)?Object(b.e)("doc-sharepoint-serviceGeneratedLinkTelemetry")&&Object(a.a)(t):Object(b.e)("doc-SxS-jsApi-ODB-Links")?Object(a.b)(t,c,n):Object(b.e)("doc-sharepoint-serviceGeneratedLinkTelemetry")&&Object(a.a)(t),g())}}});var S=!1;function g(){S||(S=!0,Object(h.o)("SharePointLinkFound"))}function _(e){var t=c.a.docLinkPreviewInfoMap.get(e),n=!!t;return(!t||t.time+i.h<=Date.now())&&Object(r.h)(e),n}Object(o.orchestrator)(r.h,function(e){var t=e.url;c.a.getWacInfoQueue.some(function(e){return e===t})||c.a.activeGetWacInfoOperations.some(function(e){return e===t})||c.a.suppressedUrls.some(function(e){return e===t})||Object(O.a)(t)||(Object(r.g)(t),Object(r.e)())}),Object(o.orchestrator)(a.e,function(e){var t=e.elements;t&&t.forEach(function(e){var t=e[i.e];t&&(e.removeEventListener("click",t),e[i.e]=null);var n=e[i.f];n&&(e.removeEventListener("mouseup",n),e[i.f]=null)})}),n.d(t,"tryProcessSharePointLink",function(){return a.d}),n.d(t,"tryUndoProcessSharePointLink",function(){return a.e}),n.d(t,"docLinkHadPreviewInfo",function(){return _}),n.d(t,"forceGetWacInfoOperation",function(){return v}),n.d(t,"getValidDocLinkPreviewInfo",function(){return O.a})},4747:function(e,t,n){"use strict";var r=n(228),c=n(1959),o=n(105),a=n(25),i=n(362),u=["https://microsoft.sharepoint.com","https://microsoft-my.sharepoint.com","https://microsoft.sharepoint-df.com","https://microsoft-my.sharepoint-df.com"];function s(e){if(!e)return Object(r.o)("isSharePointLinkCalledWithoutUrl"),!1;if("object"==typeof e){if(!(e instanceof String))return Object(r.o)("isSharePointLinkCalledWithNonNullNonStringObject",null,{cosmosOnlyData:JSON.stringify({objectProperties:Object.getOwnPropertyNames(e)})}),!1;e=e.toString(),Object(r.o)("isSharePointLinkCalledWithNonNullStringObject")}var t=Object(c.a)();return t?!!f(e,t.SPO_MySiteHostUrl,"mysite")||(!!f(e,t.SPO_RootSiteUrl,"rootsite")||!!Object(o.e)("doc-SharePoint-dogfoodUser")&&u.some(function(t){return f(e,t,"dogfood")})):(a.d.info("isSharePointLink:bposNavBarData is null"),!1)}function f(e,t,n){var c,o;try{c=Object(i.parse)(e).hostname}catch(e){return Object(r.o)("isSharePointLinkFailedToParseLinkUrl"),!1}try{o=Object(i.parse)(t).hostname}catch(e){return Object(r.o)("isSharePointLinkFailedToParseBaseUrl",{source:n}),!1}return c===o&&e!==t}function d(e){return!!e&&(e.indexOf("?at=")>0||e.indexOf("&at=")>0)}n.d(t,"a",function(){return s}),n.d(t,"b",function(){return d})},4954:function(e,t,n){"use strict";n.d(t,"a",function(){return o}),n.d(t,"b",function(){return a});var r=n(3245),c=n(3700);function o(e){return a(e).docLinkPreviewInfo||null}function a(e){var t=c.a.docLinkPreviewInfoMap.get(e);return t?t.time+r.h>Date.now()?{docLinkPreviewInfo:t}:{reason:"Expired"}:c.a.getWacInfoQueue.some(function(t){return t===e})||c.a.activeGetWacInfoOperations.some(function(t){return t===e})?{reason:"InQueue"}:c.a.suppressedUrls.some(function(t){return t===e})?{reason:"FileTypeNotSupportedOrSuppressedAfterError"}:{reason:"Unknown"}}},5611:function(e,t,n){"use strict";n.d(t,"a",function(){return c});var r=n(3245);function c(e){return e.hasAttribute(r.b)&&e.hasAttribute(r.d)&&e.hasAttribute(r.a)}},6283:function(e,t,n){"use strict";n.d(t,"a",function(){return c});var r=n(228);function c(e){Object(r.o)("SharePointLinkClick",{newTabReason:e})}},7301:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(6283),c=1;function o(e){e.button===c&&Object(r.a)("MouseMiddleButton")}},7302:function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(228),c=n(760),o=n(3245),a=n(5611);function i(e){var t,n=Date.now(),i=new r.a("ServiceGeneratedLinkClickHandler"),u="CT="+n+"&OR=OWA-"+(e?e.ctrlKey||1===e.button?"NTB":e.shiftKey?"NW":"NT":"NT")+"&CID="+Object(c.a)(),s=e.currentTarget;if(Object(a.a)(s)){var f=s.href,d=f.indexOf(o.c);if(-1===d)return;var l=encodeURIComponent(btoa(u));t=f.substr(0,d)+"&xdata="+l+o.c}else{var b=s.href.indexOf("?")>=0?"&":"?";t=s.href+b+u}i.end(),window.open(t),e.preventDefault()}},788:function(e,t,n){"use strict";function r(e){if(!e)return null;var t=e.lastIndexOf(".");return t>0?e.substr(t).toLowerCase():null}function c(e){var t=r(e);return t?t.replace(".",""):null}var o=n(1097),a=n(4);function i(e){var t;return e>=1073741824?(e/=1073741824,t=Object(a.a)(o.b)):e>=1048576?(e/=1048576,t=Object(a.a)(o.d)):e>=1024?(e/=1024,t=Object(a.a)(o.c)):t=Object(a.a)(o.a),Object(a.b)(t,Math.round(e))}function u(e){return e&&(t=e,(n=f.exec(t))&&n.length>1&&s[n[1].toLowerCase()]);var t,n}var s={"image/bmp":".bmp","image/x-ms-bmp":".bmp","image/gif":".gif","image/jpeg":".jpeg","image/png":".png","image/vnd.adobe.photoshop":".psd","image/tiff":".tiff"},f=/^\s*([^;\s]*)(?:;|\s|$)/;var d=n(35),l=[".bmp",".gif",".jpe",".jpeg",".jpg",".jfif",".dib",".png",".psd"],b=[".tiff",".tif"];function p(e,t,n){void 0===n&&(n=!0);var c=r(e)||u(t);return!!c&&(l.indexOf(c.toLowerCase())>=0||n&&b.indexOf(c.toLowerCase())>=0&&(Object(d.d)()||Object(d.c)()||Object(d.g)()||Object(d.f)()&&!Object(d.i)()))}var O,v=n(105),j=[".pdf",".doc",".docx",".odt",".rtf",".ppt",".pptx",".pptm",".potx",".potm",".pot",".ppxx",".pps",".odp"];function h(e){if(!Object(v.e)("doc-attachment-documentThumbnail"))return!1;var t=r(e);return!!t&&j.indexOf(t.toLowerCase())>=0}function m(e){switch(e){case".doc":case".docm":case".docx":case".dot":case".dotm":case".dotx":case".odt":case".rtf":return O.Word;case".csv":case".ods":case".xls":case".xlsb":case".xlsm":case".xlsx":return O.Excel;case".odp":case".pot":case".potm":case".potx":case".pps":case".ppsm":case".ppsx":case".ppt":case".pptm":case".pptx":return O.PowerPoint;default:return null}}!function(e){e[e.Word=0]="Word",e[e.Excel=1]="Excel",e[e.PowerPoint=2]="PowerPoint"}(O||(O={})),n.d(t,"b",function(){return r}),n.d(t,"c",function(){return c}),n.d(t,"g",function(){return i}),n.d(t,"e",function(){return p}),n.d(t,"f",function(){return h}),n.d(t,"d",function(){return m}),n.d(t,"a",function(){return O})}},0,[23,119]]);
//# sourceMappingURL=owa.SharePointLink.js.map
self.scriptsLoaded['owa.SharePointLink.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.SharePointLink.js'] = (new Date()).getTime();